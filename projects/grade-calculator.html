<HTML>

<head>
    <title>GradeCalculator</title>
    <script>
        function addRow() {
            var table = document.getElementById("grade-table");
            var new_row = document.getElementById("grade-table").children[0].children[1].cloneNode(true);
            new_row.style.display = ""
            table.appendChild(new_row);
        }
        function delRow() {
            var table = document.getElementById("grade-table");
            var delete_index = table.rows.length - 1
            if (delete_index > 2) {
                table.deleteRow(delete_index);
            }
        }
        function clearTable() {
            var first_row = document.getElementById("grade-table").children[0].children[2];
            var table = document.getElementById("grade-table");
            var delete_index = table.rows.length - 1
            while (delete_index > 1) {
                table.deleteRow(delete_index);
                delete_index--;
            }
            addRow();
        }
        function calcGrade() {
            var table = document.getElementById("grade-table");
            var size = table.rows.length;
            let total_weight = 0.0;
            let weights = [], grades = [];
            for (let i = 2; i < size; i++) {
                var grade_val = parseFloat(table.rows[i].children[2].innerHTML);
                var weight_val = parseFloat(table.rows[i].children[1].innerHTML);
                if (isNaN(weight_val)){
                    //empty weight but just skip and see if other rows will make 100%
                    continue;
                }
                total_weight += weight_val;
                grades.push(grade_val);
                weights.push(weight_val);
            }
            // make sure weights add up to 100
            let final_grade = 0.0, known_percent = 0.0, missing_percent = 0.0;
            if (Math.abs(100 - total_weight) < Number.EPSILON){
                for (let i = 0; i < grades.length; i++){
                    if (isNaN(grades[i])){
                        missing_percent += weights[i];
                        continue;
                    }
                    known_percent += weights[i];
                    final_grade += (weights[i] / 100) * grades[i];
                }
            }
            else {
                document.getElementById('grade-text').innerHTML = "Please make sure your weights add up to 100%.";
                return;
            }
            if (Math.abs(100 - known_percent) < Number.EPSILON){
                document.getElementById('grade-text').innerHTML = "Your grade is: " + final_grade.toFixed(2) + "%.";
            }
            else {
                let cur_grade = (final_grade / known_percent) * 100
                let max_grade = (final_grade + missing_percent);
                let min_grade = final_grade;
                document.getElementById('grade-text').innerHTML = "Your current known grade is: " + cur_grade.toFixed(2) + "%.<br>" + "Your minimum grade is: " + min_grade.toFixed(2) + "%.<br>" + "Your maximum grade is: " + max_grade.toFixed(2) + "%.";
            }
        }
    </script>
    <style>
        .flex-parent {
            display: flex;
        }

        .jc-center {
            justify-content: center;
        }

        H1 {
            text-align: center;
        }

        H2 {
            text-align: center;
        }

        P {
            text-align: center;
        }

        table.center {
            margin-left: auto;
            margin-right: auto;
            table-layout: fixed;
            width: 300px;
            word-break: break-all;
        }

        td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 10px;
            text-align: right;
        }
    </style>
</head>

<H1>Grade Calculator</H1>
<P> Fill in the table below to calculate your grade.<br>
    Make sure all of your weights add up to 100%<br>
    Leave the grade blank if you do not know the grade for that assignment.
</P>
<div class="flex-parent jc-center">
    <button id="ar-btn" type="button" onclick="addRow()">Add Row</button>
    <button id="rr-btn" type="button" onclick="delRow()">Remove Row</button>
    <button id="c-btn" type="button" onclick="clearTable()">Clear</button>
    <button id="calc-btn" type="button" onclick="calcGrade()">Calculate Grade</button>
</div>
<div class="flex-parent jc-center">
    <p id='grade-text'>Your grade is: </p>
</div>
<table id="grade-table" class="center">
    <tr>
        <th width="40%">Assignment</th>
        <th width="30%">Weight (%)</th>
        <th width="30%">Grade (%)</th>
    </tr>
    <tr style="display:none">
        <td contenteditable='true'></td>
        <td contenteditable='true'></td>
        <td contenteditable='true'></td>
    </tr>
    <tr>
        <td contenteditable='true'></td>
        <td contenteditable='true'></td>
        <td contenteditable='true'></td>
    </tr>
</table>


</HTML>